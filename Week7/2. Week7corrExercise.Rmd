---
title: "Bivariate correlation exercise"
---

# Testing a correlation

This exercise uses the built-in CO2 dataset. Type "? CO2" to see the documentation. 

Annotate the R code in the next cell with comments. Add line spacing or break the code into multiple cells as appropriate to improve the appearance of the code and the results. 

```{r}
# install.packages("BayesFactor") # Uncomment if not installed
library("BayesFactor")
data("CO2")
?CO2

dim(CO2)

```

```{r}
hist(CO2$conc)
hist(CO2$uptake)
plot(CO2$conc, CO2$uptake)
```

```{r}
options(scipen=999)  # turn-off scientific notation like 1e+48
cor(CO2$conc, CO2$uptake)
cor.test(CO2$conc, CO2$uptake)
```

```{r}
bfCorTest <- function(x, y) {
  zx <- scale(x) 
  zy <- scale(y) 
  zData <- data.frame(x=zx, rhoNot0=zy) 
  bfOut <- generalTestBF(x ~ rhoNot0, data=zData) 
  mcmcOut <- posterior(bfOut, iterations=100000) 
  plot(mcmcOut[, "rhoNot0"])
  print(summary(mcmcOut[, "rhoNot0"])) 
  return(bfOut) 
}
bfCorTest(CO2$conc,CO2$uptake)
```

Note: instead of using the bfCorTest function from the text, you can use the correlationBF function from BayesFactor library. 

```{r}
correlationBF(CO2$conc, CO2$uptake)
samples <- correlationBF(CO2$conc, CO2$uptake, posterior = TRUE, iterations = 1000)
plot(samples)
summary(samples[, "rho"])
```

Explain the results, integrating the Bayesian estimation, Bayes factor and conventional results.


# Testing equality of correlations. 

```{r}
# Subset the data
quebec <- CO2[CO2$Type=="Quebec", ]
missip <- CO2[CO2$Type=="Mississippi", ]
```

```{r}
cor(quebec$conc,quebec$uptake)
cor.test(quebec$conc,quebec$uptake)
cor(missip$conc,missip$uptake)
cor.test(missip$conc,missip$uptake)
```

Are the two correlations equivalent?

```{r}
#install.packages("cocor")
require("cocor") # load package
cocor.indep.groups(r1.jk=cor(quebec$conc,quebec$uptake), 
                   r2.hm=cor(missip$conc,missip$uptake), 
                   n1=length(quebec$conc), 
                   n2=length(missip$conc), 
                   alternative="two.sided", 
                   alpha=0.05, conf.level=0.95, null.value=0)
```

Reinterpret your results from above in light of your comparison between the two correlations.

